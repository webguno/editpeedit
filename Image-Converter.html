<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Image Tools Web App</title>
  <style>
    * { box-sizing: border-box; }
    body { font-family: Arial, sans-serif; margin: 0; background: #f3f4f6; }
    .app { max-width: 500px; margin: auto; padding: 10px; }
    header { background: #1f2937; color: white; padding: 10px; text-align: center; }
    nav { display: flex; overflow-x: auto; gap: 5px; margin-top: 10px; }
    nav button {
      flex: 1; padding: 10px; background: #374151; border: none;
      color: white; cursor: pointer; border-radius: 4px;
    }
    nav button:hover { background: #4b5563; }
    main {
      background: white; padding: 15px; margin-top: 10px;
      border-radius: 8px;
    }
    .tool { display: none; margin-top: 10px; }
    .tool.active { display: block; }
    #preview {
      width: 100%; max-height: 300px; object-fit: contain;
      margin-top: 10px; border: 1px solid #ddd; border-radius: 5px;
    }
    input[type="file"] { width: 100%; }
    pre { background: #f9f9f9; padding: 10px; white-space: pre-wrap; }
    button.action { margin-top: 10px; padding: 10px; background: #10b981; color: white; border: none; border-radius: 5px; cursor: pointer; }
    button.action:hover { background: #059669; }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>Image Tool Box</h1>
      <nav>
        <button data-tab="convert">Convert</button>
        <button data-tab="compress">Compress</button>
        <button data-tab="crop">Crop</button>
        <button data-tab="rotate">Rotate</button>
        <button data-tab="ocr">OCR</button>
      </nav>
    </header>

    <main>
      <input type="file" id="imageInput" accept="image/*">
      <img id="preview" src="" alt="Preview" />

      <!-- Convert Tool -->
      <section class="tool active" id="convert">
        <h2>Convert Image</h2>
        <select id="convertFormat">
          <option value="image/png">PNG</option>
          <option value="image/jpeg">JPG</option>
          <option value="image/webp">WEBP</option>
        </select>
        <button class="action" onclick="convertImage()">Convert</button>
      </section>

      <!-- Compress Tool -->
      <section class="tool" id="compress">
        <h2>Compress Image</h2>
        <label>Quality (0.1 to 1):</label>
        <input type="range" id="compressQuality" min="0.1" max="1" step="0.1" value="0.8">
        <button class="action" onclick="compressImage()">Compress</button>
      </section>

      <!-- Crop Tool -->
      <section class="tool" id="crop">
        <h2>Crop Image</h2>
        <p>Center crop to 200x200px (demo)</p>
        <button class="action" onclick="cropImage()">Crop</button>
      </section>

      <!-- Rotate Tool -->
      <section class="tool" id="rotate">
        <h2>Rotate Image</h2>
        <button class="action" onclick="rotateImage()">Rotate 90Â°</button>
      </section>

      <!-- OCR Tool -->
      <section class="tool" id="ocr">
        <h2>Extract Text (OCR)</h2>
        <button class="action" onclick="extractText()">Extract</button>
        <pre id="ocrResult">No text extracted yet.</pre>
      </section>
    </main>
  </div>

  <!-- Tesseract for OCR -->
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@2/dist/tesseract.min.js"></script>

  <script>
    const imageInput = document.getElementById("imageInput");
    const preview = document.getElementById("preview");
    let image = new Image();
    let canvas = document.createElement("canvas");
    let ctx = canvas.getContext("2d");

    imageInput.addEventListener("change", (e) => {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = (event) => {
          image.src = event.target.result;
          preview.src = event.target.result;
        };
        reader.readAsDataURL(file);
      }
    });

    // Tab Switching
    document.querySelectorAll("nav button").forEach(btn => {
      btn.onclick = () => {
        document.querySelectorAll(".tool").forEach(t => t.classList.remove("active"));
        document.getElementById(btn.dataset.tab).classList.add("active");
      };
    });

    function download(blob, name) {
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = name;
      a.click();
    }

    function convertImage() {
      const format = document.getElementById("convertFormat").value;
      canvas.width = image.width;
      canvas.height = image.height;
      ctx.drawImage(image, 0, 0);
      canvas.toBlob(blob => download(blob, "converted." + format.split("/")[1]), format);
    }

    function compressImage() {
      const quality = parseFloat(document.getElementById("compressQuality").value);
      canvas.width = image.width;
      canvas.height = image.height;
      ctx.drawImage(image, 0, 0);
      canvas.toBlob(blob => download(blob, "compressed.jpg"), "image/jpeg", quality);
    }

    function cropImage() {
      const cropSize = 200;
      canvas.width = cropSize;
      canvas.height = cropSize;
      const sx = (image.width - cropSize) / 2;
      const sy = (image.height - cropSize) / 2;
      ctx.drawImage(image, sx, sy, cropSize, cropSize, 0, 0, cropSize, cropSize);
      canvas.toBlob(blob => download(blob, "cropped.png"), "image/png");
    }

    let rotateAngle = 0;
    function rotateImage() {
      rotateAngle = (rotateAngle + 90) % 360;
      canvas.width = image.height;
      canvas.height = image.width;
      ctx.save();
      ctx.translate(canvas.width / 2, canvas.height / 2);
      ctx.rotate((rotateAngle * Math.PI) / 180);
      ctx.drawImage(image, -image.width / 2, -image.height / 2);
      ctx.restore();
      preview.src = canvas.toDataURL();
      canvas.toBlob(blob => download(blob, "rotated.png"), "image/png");
    }

    function extractText() {
      if (!preview.src) return alert("Upload an image first!");
      document.getElementById("ocrResult").textContent = "Extracting...";
      Tesseract.recognize(preview.src, "eng")
        .then(({ data: { text } }) => {
          document.getElementById("ocrResult").textContent = text || "No text found.";
        });
    }
  </script>
</body>
</html>
